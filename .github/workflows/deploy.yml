deploy:
  name: Deploy over SSH
  runs-on: ubuntu-latest
  needs:
    - docker-push-authservice
    - docker-push-userservice
    - docker-push-llmservice
    - docker-push-gatewayservice
    - docker-push-webapp
    - docker-push-wikiquestionservice
    - docker-push-statsservice
  steps:
    - name: Deploy over SSH
      uses: fifsky/ssh-action@master
      with:
        host: ${{ secrets.DEPLOY_HOST }}
        user: ${{ secrets.DEPLOY_USER }}
        key: ${{ secrets.DEPLOY_KEY }}
        command: |
          # Descargar el archivo docker-compose.yml desde el repositorio
          wget https://raw.githubusercontent.com/arquisoft/wichat_es3b/master/docker-compose.yml -O docker-compose.yml

          # Apagar cualquier contenedor en ejecución
          docker compose --profile prod down

          # Levantar los contenedores con la configuración de producción
          docker compose --profile prod up -d --pull always
